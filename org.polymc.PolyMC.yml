app-id: org.polymc.PolyMC
runtime: org.kde.Platform
runtime-version: "5.15"
sdk: org.kde.Sdk
command: polymc
finish-args:
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --share=network
modules:
  - name: compile
    buildsystem: simple
    build-commands:
      - echo $PWD
      - ls jdk
      - mkdir build
      - mkdir -p /app/bin
      - cd build && JAVA_HOME=/run/build/compile/jdk PATH=$JAVA_HOME:$PATH JAVA_COMPILER=../jdk/bin/javac cmake -DLauncher_LAYOUT=lin-system -DCMAKE_INSTALL_PREFIX=/app/ .. && make -j$(nproc) install
    sources:
      - type: git
        url: https://github.com/PolyMC/PolyMC.git
        branch: develop
      - type: archive
        url: https://github.com/adoptium/temurin17-binaries/releases/download/jdk-17%2B35/OpenJDK17-jdk_x64_linux_hotspot_17_35.tar.gz
        sha256: 6f1335d9a7855159f982dac557420397be9aa85f3f7bc84e111d25871c02c0c7
        archive-type: tar-gzip
        dest: jdk
  # old MC versions depend on Xrandr
  - name: xrandr
    buildsystem: simple
    build-commands:
      - ./configure --prefix=/app
      - make
      - make install
      - ls /app/bin/
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/archive/individual/app/xrandr-1.5.1.tar.xz
        sha256: 7bc76daf9d72f8aff885efad04ce06b90488a1a169d118dea8a2b661832e8762
